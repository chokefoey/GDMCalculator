<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GDM Insulin Calculator & Logbook</title>
    
    <!-- 1. Import React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 2. Import Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 3. Import Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Styles & Print Styles -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Print Specific Styles */
        @media print {
            @page { margin: 0.5cm; size: A4; }
            body { background: white; -webkit-print-color-adjust: exact; }
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            .print-container { 
                width: 100% !important; 
                max-width: none !important; 
                margin: 0 !important; 
                padding: 0 !important;
                box-shadow: none !important;
                border: none !important;
            }
            .page-break { page-break-after: always; }
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-900">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icon Components ---
        const IconCalculator = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>;
        const IconSyringe = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m18 2 4 4"/><path d="m17 7 3-3"/><path d="M19 9 8.7 19.3c-1 1-2.5 1-3.4 0l-.6-.6c-1-1-1-2.5 0-3.4L15 5"/><path d="m9 11 4 4"/><path d="m5 19-3 3"/><path d="m14 4 6 6"/></svg>;
        const IconCalendar = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>;
        const IconInfo = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>;
        const IconAlertCircle = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>;
        const IconCopy = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>;
        const IconCheck = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 6 9 17l-5-5"/></svg>;
        const IconClock = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
        const IconBookOpen = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>;
        const IconArrowLeft = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>;
        const IconTarget = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>;
        const IconTable = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="3" x2="21" y1="9" y2="9"/><line x1="3" x2="21" y1="15" y2="15"/><line x1="12" x2="12" y1="3" y2="21"/></svg>;
        const IconPrinter = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></svg>;
        const IconFood = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 20.94c1.61 0 3.11-.29 4.47-.8 2.06-.77 3.53-2.61 3.53-4.8 0-4.04-3.58-6.17-8-6.17s-8 2.13-8 6.17c0 2.19 1.47 4.03 3.53 4.8 1.36.51 2.86.8 4.47.8Z"/><path d="M10 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2Z"/><path d="M12 9.17V6"/></svg>;
        const IconVideo = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="8" x2="8" y1="21" y2="21"/><line x1="16" x2="16" y1="21" y2="21"/><line x1="12" x2="12" y1="15" y2="21"/><path d="m10 9 5 3-5 3z"/></svg>;

        // --- Logbook View Component ---
        const LogbookView = ({ onBack }) => {
            const rows = Array.from({ length: 30 }, (_, i) => i + 1);

            return (
                <div className="bg-white min-h-screen">
                    {/* Toolbar (Hidden when printing) */}
                    <div className="no-print p-4 border-b border-slate-200 flex justify-between items-center bg-slate-50 sticky top-0 z-20">
                        <button onClick={onBack} className="flex items-center gap-2 text-slate-600 hover:text-blue-600 transition-colors">
                            <IconArrowLeft /> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                        </button>
                        <button 
                            onClick={() => window.print()} 
                            className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 shadow-sm transition-all"
                        >
                            <IconPrinter /> ‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á (Print)
                        </button>
                    </div>

                    {/* Printable Area */}
                    <div className="p-8 print-container max-w-5xl mx-auto">
                        <div className="flex justify-between items-end mb-6 border-b-2 border-slate-800 pb-4">
                            <div>
                                <h1 className="text-2xl font-bold text-slate-900">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• (SMBG Logbook)</h1>
                                <p className="text-slate-500 text-sm">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå (Gestational Diabetes Mellitus)</p>
                            </div>
                            <div className="text-right text-xs text-slate-400">
                                <p>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å 30 ‡∏ß‡∏±‡∏ô</p>
                            </div>
                        </div>

                        <div className="grid grid-cols-2 gap-8 mb-6 text-sm">
                            <div className="space-y-4">
                                <div className="border-b border-dotted border-slate-400 pb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•: </div>
                                <div className="border-b border-dotted border-slate-400 pb-1">HN: </div>
                            </div>
                            <div className="space-y-4">
                                <div className="border-b border-dotted border-slate-400 pb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: </div>
                                <div className="border-b border-dotted border-slate-400 pb-1">‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•: </div>
                            </div>
                        </div>

                        <div className="flex gap-4 mb-4 text-xs">
                            <div className="flex-1 bg-slate-50 border border-slate-200 rounded p-2 flex items-center justify-between print:border-slate-300">
                                <strong className="text-slate-700">TARGETS:</strong>
                                <div className="flex gap-6">
                                    <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-green-500 print:bg-slate-400"></span> Fasting &lt; 95</span>
                                    <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-blue-500 print:bg-slate-400"></span> 2hr Post-Meal &lt; 120</span>
                                </div>
                            </div>
                        </div>

                        <table className="w-full border-collapse border border-slate-300 text-sm mb-4">
                            <thead>
                                <tr className="bg-slate-100 print:bg-slate-50 text-slate-700">
                                    <th className="border border-slate-400 p-2 w-12 text-center">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th className="border border-slate-400 p-2 w-24 text-center">‡∏ß/‡∏î/‡∏õ</th>
                                    <th className="border border-slate-400 p-2 text-center bg-green-50 print:bg-white">
                                        <div className="font-bold">Fasting</div>
                                        <div className="text-[10px] font-normal text-slate-500">&lt; 95 mg/dL</div>
                                    </th>
                                    <th className="border border-slate-400 p-2 text-center">
                                        <div className="font-bold">2hr ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏ä‡πâ‡∏≤</div>
                                        <div className="text-[10px] font-normal text-slate-500">&lt; 120 mg/dL</div>
                                    </th>
                                    <th className="border border-slate-400 p-2 text-center">
                                        <div className="font-bold">2hr ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á</div>
                                        <div className="text-[10px] font-normal text-slate-500">&lt; 120 mg/dL</div>
                                    </th>
                                    <th className="border border-slate-400 p-2 text-center">
                                        <div className="font-bold">2hr ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏¢‡πá‡∏ô</div>
                                        <div className="text-[10px] font-normal text-slate-500">&lt; 120 mg/dL</div>
                                    </th>
                                    <th className="border border-slate-400 p-2 text-center w-40">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ / ‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏â‡∏µ‡∏î</th>
                                </tr>
                            </thead>
                            <tbody>
                                {rows.map(day => (
                                    <tr key={day} className="h-9">
                                        <td className="border border-slate-300 text-center text-xs text-slate-400 bg-slate-50 print:bg-white">{day}</td>
                                        <td className="border border-slate-300"></td>
                                        <td className="border border-slate-300 bg-green-50/30 print:bg-white"></td>
                                        <td className="border border-slate-300"></td>
                                        <td className="border border-slate-300"></td>
                                        <td className="border border-slate-300"></td>
                                        <td className="border border-slate-300"></td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>

                        <div className="text-xs text-slate-500 mt-4 border-t border-slate-200 pt-2">
                            <p className="mb-1"><strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏±‡∏ß‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥:</strong></p>
                            <ul className="list-disc list-inside space-y-0.5 ml-2">
                                <li>‡∏´‡∏≤‡∏Å <strong>Hypoglycemia (&lt; 60-70 mg/dL)</strong> ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏à‡∏™‡∏±‡πà‡∏ô ‡πÄ‡∏´‡∏á‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å: ‡πÉ‡∏´‡πâ‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏´‡∏ß‡∏≤‡∏ô 1 ‡πÅ‡∏Å‡πâ‡∏ß ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏π‡∏Å‡∏≠‡∏° 2-3 ‡πÄ‡∏°‡πá‡∏î ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏à‡∏≤‡∏∞‡∏ã‡πâ‡∏≥‡πÉ‡∏ô 15 ‡∏ô‡∏≤‡∏ó‡∏µ</li>
                                <li>‡∏´‡∏≤‡∏Å <strong>Hyperglycemia (‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢)</strong> ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô 3 ‡∏ß‡∏±‡∏ô: ‡πÇ‡∏õ‡∏£‡∏î‡∏ô‡∏≥‡∏™‡∏°‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡∏°‡∏≤‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏±‡∏î</li>
                            </ul>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Diet Advice View Component ---
        const DietView = ({ onBack }) => {
            return (
                <div className="animate-fade-in pb-10">
                    <div className="p-6 space-y-6">
                        <button 
                            onClick={onBack}
                            className="flex items-center gap-2 text-sm text-slate-500 hover:text-blue-600 mb-2 transition-colors"
                        >
                            <div className="w-4 h-4"><IconArrowLeft /></div>
                            ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
                        </button>

                        <div className="border-b border-slate-200 pb-4">
                            <h2 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                                <div className="w-6 h-6 text-orange-500"><IconFood /></div>
                                ‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏™‡∏ï‡∏£‡∏µ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå (GDM Diet)
                            </h2>
                            <p className="text-sm text-slate-500 flex items-center gap-1">
                                ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á: Chulabhorn Channel (CRA) & Medical Guidelines
                            </p>
                        </div>

                         {/* Video Section */}
                        <div className="bg-slate-900 rounded-xl overflow-hidden shadow-lg mb-6">
                            <div className="aspect-video w-full">
                                <iframe 
                                    className="w-full h-full"
                                    src="https://www.youtube.com/embed/Ei-Bm7Wd57o" 
                                    title="‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏´‡∏ç‡∏¥‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå"
                                    frameBorder="0"
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                    allowFullScreen
                                ></iframe>
                            </div>
                            <div className="p-3 bg-slate-800 text-white text-xs flex justify-between items-center">
                                <span className="flex items-center gap-2"><IconVideo /> ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ç‡∏¥‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå</span>
                                <span className="text-slate-400">by Chulabhorn Channel</span>
                            </div>
                        </div>

                        <div className="space-y-4">
                            
                            {/* 1. Rice & Flour */}
                            <div className="bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm">
                                <div className="bg-orange-50 p-3 border-b border-orange-100 flex items-center gap-2">
                                    <span className="bg-orange-500 text-white w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold">1</span>
                                    <h3 className="font-bold text-slate-800 text-sm">‡∏´‡∏°‡∏ß‡∏î‡∏Ç‡πâ‡∏≤‡∏ß-‡πÅ‡∏õ‡πâ‡∏á (Carbohydrates)</h3>
                                </div>
                                <div className="p-4 space-y-3">
                                    <p className="text-xs text-slate-600">‡∏Ñ‡∏ß‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≤‡∏£‡πå‡πÇ‡∏ö‡πÑ‡∏Æ‡πÄ‡∏î‡∏£‡∏ï‡πÄ‡∏ä‡∏¥‡∏á‡∏ã‡πâ‡∏≠‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏ä‡πâ‡∏≤‡πÜ</p>
                                    <div className="grid grid-cols-2 gap-3 text-xs">
                                        <div className="space-y-1">
                                            <strong className="text-green-700">‚úÖ ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≤‡∏ô:</strong>
                                            <ul className="list-disc list-inside text-slate-600 pl-1">
                                                <li>‡∏Ç‡πâ‡∏≤‡∏ß‡∏Å‡∏•‡πâ‡∏≠‡∏á / ‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏£‡∏ã‡πå‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà</li>
                                                <li>‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡πÇ‡∏Æ‡∏•‡∏ß‡∏µ‡∏ï</li>
                                                <li>‡∏ò‡∏±‡∏ç‡∏û‡∏∑‡∏ä, ‡∏•‡∏π‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏¢, ‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î</li>
                                            </ul>
                                        </div>
                                        <div className="space-y-1">
                                            <strong className="text-red-700">‚ùå ‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á/‡∏•‡∏î:</strong>
                                            <ul className="list-disc list-inside text-slate-600 pl-1">
                                                <li>‡∏Ç‡πâ‡∏≤‡∏ß‡∏Ç‡∏≤‡∏ß (‡∏Ç‡∏±‡∏î‡∏™‡∏µ)</li>
                                                <li>‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß (GI ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å)</li>
                                                <li>‡πÄ‡∏™‡πâ‡∏ô‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß, ‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà</li>
                                                <li>‡πÇ‡∏à‡πä‡∏Å/‡∏Ç‡πâ‡∏≤‡∏ß‡∏ï‡πâ‡∏° (‡∏î‡∏π‡∏î‡∏ã‡∏∂‡∏°‡πÄ‡∏£‡πá‡∏ß)</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* 2. Fruits */}
                            <div className="bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm">
                                <div className="bg-green-50 p-3 border-b border-green-100 flex items-center gap-2">
                                    <span className="bg-green-500 text-white w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold">2</span>
                                    <h3 className="font-bold text-slate-800 text-sm">‡∏´‡∏°‡∏ß‡∏î‡∏ú‡∏•‡πÑ‡∏°‡πâ (Fruits)</h3>
                                </div>
                                <div className="p-4 space-y-3">
                                    <p className="text-xs text-slate-600">‡∏ó‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 2-3 ‡∏™‡πà‡∏ß‡∏ô (1 ‡∏™‡πà‡∏ß‡∏ô = 1 ‡∏à‡∏≤‡∏ô‡∏£‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡∏ß‡∏Å‡∏≤‡πÅ‡∏ü ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏≥‡∏õ‡∏±‡πâ‡∏ô)</p>
                                    <div className="grid grid-cols-1 gap-3 text-xs">
                                        <div className="bg-green-50 p-2 rounded-lg border border-green-100">
                                            <strong className="text-green-800">‚úÖ ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏´‡∏ß‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏¢ (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥):</strong>
                                            <p className="text-slate-600 mt-1">‡∏ù‡∏£‡∏±‡πà‡∏á (1‡∏ú‡∏•), ‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡πâ‡∏•‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß (1‡∏ú‡∏•), ‡πÅ‡∏Å‡πâ‡∏ß‡∏°‡∏±‡∏á‡∏Å‡∏£ (1/2‡∏ú‡∏•), ‡∏ä‡∏°‡∏û‡∏π‡πà (2-3‡∏ú‡∏•), ‡∏™‡∏≤‡∏•‡∏µ‡πà (1/2‡∏ú‡∏•)</p>
                                        </div>
                                        <div className="bg-red-50 p-2 rounded-lg border border-red-100">
                                            <strong className="text-red-800">‚ùå ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏´‡∏ß‡∏≤‡∏ô‡∏à‡∏±‡∏î (‡∏á‡∏î/‡∏à‡∏≥‡∏Å‡∏±‡∏î):</strong>
                                            <p className="text-slate-600 mt-1">‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô, ‡∏•‡∏≥‡πÑ‡∏¢, ‡∏Ç‡∏ô‡∏∏‡∏ô, ‡∏≠‡∏á‡∏∏‡πà‡∏ô, ‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á‡∏™‡∏∏‡∏Å, ‡∏ô‡πâ‡∏≠‡∏¢‡∏´‡∏ô‡πà‡∏≤, ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á, ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡πÅ‡∏´‡πâ‡∏á</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                             {/* 3. Vegetables */}
                             <div className="bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm">
                                <div className="bg-emerald-50 p-3 border-b border-emerald-100 flex items-center gap-2">
                                    <span className="bg-emerald-600 text-white w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold">3</span>
                                    <h3 className="font-bold text-slate-800 text-sm">‡∏´‡∏°‡∏ß‡∏î‡∏ú‡∏±‡∏Å (Vegetables)</h3>
                                </div>
                                <div className="p-4">
                                    <p className="text-xs text-slate-600 mb-2">‡∏ó‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì ‡πÄ‡∏ô‡πâ‡∏ô‡∏ú‡∏±‡∏Å‡πÉ‡∏ö‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß ‡∏Å‡∏≤‡∏Å‡πÉ‡∏¢‡∏ä‡πà‡∏ß‡∏¢‡∏ä‡∏∞‡∏•‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏î‡∏ã‡∏∂‡∏°‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•</p>
                                    <ul className="list-disc list-inside text-xs text-slate-600">
                                        <li>‡∏ú‡∏±‡∏Å‡∏Ñ‡∏∞‡∏ô‡πâ‡∏≤, ‡∏ú‡∏±‡∏Å‡∏Å‡∏≤‡∏î‡∏Ç‡∏≤‡∏ß, ‡∏ú‡∏±‡∏Å‡∏ö‡∏∏‡πâ‡∏á</li>
                                        <li>‡πÅ‡∏ï‡∏á‡∏Å‡∏ß‡∏≤, ‡∏°‡∏∞‡πÄ‡∏Ç‡∏∑‡∏≠‡πÄ‡∏ó‡∏®</li>
                                        <li>‡πÅ‡∏Å‡∏á‡∏à‡∏∑‡∏î, ‡πÅ‡∏Å‡∏á‡πÄ‡∏•‡∏µ‡∏¢‡∏á, ‡πÅ‡∏Å‡∏á‡∏™‡πâ‡∏° (‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÉ‡∏ô‡∏ô‡πâ‡∏≥‡πÅ‡∏Å‡∏á)</li>
                                    </ul>
                                    <p className="text-[10px] text-red-500 mt-2">*‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏ú‡∏±‡∏Å‡∏´‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÅ‡∏õ‡πâ‡∏á‡∏™‡∏π‡∏á ‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏±‡∏ô‡∏ù‡∏£‡∏±‡πà‡∏á, ‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å, ‡∏ü‡∏±‡∏Å‡∏ó‡∏≠‡∏á (‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏î‡∏Ç‡πâ‡∏≤‡∏ß‡∏•‡∏á‡∏´‡∏≤‡∏Å‡∏ó‡∏≤‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞)</p>
                                </div>
                            </div>

                            {/* 4. Meat & Milk */}
                            <div className="bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm">
                                <div className="bg-blue-50 p-3 border-b border-blue-100 flex items-center gap-2">
                                    <span className="bg-blue-500 text-white w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold">4</span>
                                    <h3 className="font-bold text-slate-800 text-sm">‡∏´‡∏°‡∏ß‡∏î‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå & ‡∏ô‡∏° (Protein & Dairy)</h3>
                                </div>
                                <div className="p-4 space-y-3 text-xs">
                                    <div>
                                        <strong className="text-blue-800">üêü ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏™‡∏±‡∏ï‡∏ß‡πå:</strong> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏°‡∏±‡∏ô ‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏´‡∏ô‡∏±‡∏á
                                        <p className="text-slate-600">‡∏õ‡∏•‡∏≤, ‡πÑ‡∏Å‡πà‡∏•‡∏≠‡∏Å‡∏´‡∏ô‡∏±‡∏á, ‡πÑ‡∏Ç‡πà‡∏ï‡πâ‡∏° (‡πÑ‡∏Ç‡πà‡πÅ‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 1 ‡∏ü‡∏≠‡∏á), ‡πÄ‡∏ï‡πâ‡∏≤‡∏´‡∏π‡πâ</p>
                                    </div>
                                    <div className="border-t border-slate-100 pt-2">
                                        <strong className="text-blue-800">ü•õ ‡∏ô‡∏°:</strong> ‡∏Ñ‡∏ß‡∏£‡∏î‡∏∑‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 1-2 ‡πÅ‡∏Å‡πâ‡∏ß
                                        <p className="text-slate-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <strong>‡∏ô‡∏°‡∏à‡∏∑‡∏î‡∏û‡∏£‡πà‡∏≠‡∏á‡∏°‡∏±‡∏ô‡πÄ‡∏ô‡∏¢</strong> ‡∏´‡∏£‡∏∑‡∏≠ <strong>‡∏ô‡∏°‡∏ñ‡∏±‡πà‡∏ß‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏™‡∏π‡∏ï‡∏£‡∏´‡∏ß‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏¢/‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•</strong></p>
                                        <p className="text-red-500 mt-1">*‡∏á‡∏î ‡∏ô‡∏°‡πÄ‡∏õ‡∏£‡∏µ‡πâ‡∏¢‡∏ß, ‡∏ô‡∏°‡∏£‡∏™‡∏´‡∏ß‡∏≤‡∏ô, ‡∏ô‡∏°‡∏Ç‡πâ‡∏ô‡∏´‡∏ß‡∏≤‡∏ô</p>
                                    </div>
                                </div>
                            </div>

                            {/* 5. Avoid List */}
                            <div className="bg-red-50 border border-red-100 rounded-xl p-4 shadow-sm">
                                <h3 className="font-bold text-red-800 text-sm mb-2 flex items-center gap-2">
                                    <IconAlertCircle /> ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏á‡∏î‡πÄ‡∏ß‡πâ‡∏ô‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î
                                </h3>
                                <ul className="list-disc list-inside text-xs text-red-700 space-y-1">
                                    <li>‡∏ô‡πâ‡∏≥‡∏´‡∏ß‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏ä‡∏ô‡∏¥‡∏î: ‡∏ä‡∏≤‡πÄ‡∏¢‡πá‡∏ô, ‡∏Å‡∏≤‡πÅ‡∏ü‡πÄ‡∏¢‡πá‡∏ô, ‡∏ô‡∏°‡πÄ‡∏¢‡πá‡∏ô, ‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏î‡∏•‡∏°</li>
                                    <li>‡∏Ç‡∏ô‡∏°‡∏´‡∏ß‡∏≤‡∏ô: ‡∏ó‡∏≠‡∏á‡∏´‡∏¢‡∏¥‡∏ö, ‡∏ó‡∏≠‡∏á‡∏´‡∏¢‡∏≠‡∏î, ‡πÄ‡∏Ñ‡πâ‡∏Å, ‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ, ‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°</li>
                                    <li>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏™: ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏ó‡∏£‡∏≤‡∏¢ (‡∏õ‡∏£‡∏∏‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)</li>
                                    <li>‡∏ú‡∏•‡πÑ‡∏°‡πâ‡πÅ‡∏õ‡∏£‡∏£‡∏π‡∏õ: ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏î‡∏≠‡∏á, ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡πÅ‡∏ä‡πà‡∏≠‡∏¥‡πà‡∏°</li>
                                </ul>
                            </div>

                        </div>
                    </div>
                </div>
            );
        };

        // --- Education Component ---
        const EducationView = ({ onBack }) => {
            return (
                <div className="animate-fade-in pb-10">
                    <div className="p-6 space-y-6">
                        <button 
                            onClick={onBack}
                            className="flex items-center gap-2 text-sm text-slate-500 hover:text-blue-600 mb-2 transition-colors"
                        >
                            <div className="w-4 h-4"><IconArrowLeft /></div>
                            ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
                        </button>

                        <div className="border-b border-slate-200 pb-4">
                            <h2 className="text-xl font-bold text-slate-800">Diabetes and Pregnancy</h2>
                            <p className="text-sm text-slate-500">‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏à‡∏≤‡∏Å: ‡∏ô‡∏û.‡∏ì‡∏±‡∏ê‡∏û‡∏• ‡∏™‡∏ñ‡∏≤‡∏ß‡∏£‡∏î‡∏°</p>
                        </div>
                        
                        <div className="space-y-3">
                            <h3 className="text-sm font-bold text-green-700 uppercase tracking-wider flex items-center gap-2">
                                <div className="w-4 h-4"><IconTarget /></div>
                                ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• (Targets)
                            </h3>
                            <div className="bg-green-50 p-4 rounded-xl border border-green-100 space-y-2">
                                <div className="flex justify-between items-center border-b border-green-200 pb-2">
                                    <span className="text-sm text-green-800">Fasting</span>
                                    <span className="font-bold text-green-700">&lt; 95 mg/dL</span>
                                </div>
                                <div className="flex justify-between items-center border-b border-green-200 pb-2">
                                    <span className="text-sm text-green-800">1-hr Postprandial</span>
                                    <span className="font-bold text-green-700">&lt; 140 mg/dL</span>
                                </div>
                                <div className="flex justify-between items-center">
                                    <span className="text-sm text-green-800">2-hr Postprandial</span>
                                    <span className="font-bold text-green-700">&lt; 120 mg/dL</span>
                                </div>
                            </div>
                        </div>

                         {/* Classification */}
                         <div className="space-y-3">
                            <h3 className="text-sm font-bold text-blue-700 uppercase tracking-wider flex items-center gap-2">
                                ‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (Classification)
                            </h3>
                            <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm space-y-3">
                                <div>
                                    <p className="font-semibold text-slate-800 text-sm">Pregestational Diabetes</p>
                                    <p className="text-xs text-slate-500">‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå (Type 1 ‡∏´‡∏£‡∏∑‡∏≠ Type 2)</p>
                                </div>
                                <div className="border-t border-slate-100 pt-2">
                                    <p className="font-semibold text-slate-800 text-sm">Gestational Diabetes (GDM)</p>
                                    <p className="text-xs text-slate-500 mb-2">‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏Ç‡∏ì‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå</p>
                                    <ul className="list-disc list-inside text-xs text-slate-600 space-y-1 ml-1">
                                        <li><strong>GDM A1:</strong> ‡∏Ñ‡∏∏‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (Diet controlled)</li>
                                        <li><strong>GDM A2:</strong> ‡πÉ‡∏ä‡πâ‡∏¢‡∏≤ (Medication required)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main Component ---
        const InsulinCalculator = () => {
            const [view, setView] = useState('calculator'); // 'calculator', 'education', 'logbook', 'diet'
            
            // Calculator States
            const [calcMode, setCalcMode] = useState('edd');
            const [weight, setWeight] = useState('');
            const [manualGa, setManualGa] = useState('');
            const [edd, setEdd] = useState('');
            const [visitDate, setVisitDate] = useState(new Date().toISOString().split('T')[0]);
            const [regimen, setRegimen] = useState('basal-bolus');
            const [showSmbg, setShowSmbg] = useState(false);
            
            const [tdd, setTdd] = useState(0);
            const [factor, setFactor] = useState(0.7);
            const [calculationResult, setCalculationResult] = useState(null);
            const [showCopyFeedback, setShowCopyFeedback] = useState(false);
            const [showSmbgCopyFeedback, setShowSmbgCopyFeedback] = useState(false);
            const [gaDisplay, setGaDisplay] = useState('');

            const REGIMEN_BASAL_BOLUS = 'basal-bolus';
            const REGIMEN_SPLIT_MIXED = 'split-mixed';

            useEffect(() => {
                let currentGaWeeks = 0;
                let gaString = '';

                if (calcMode === 'manual') {
                    if (!manualGa) {
                        setCalculationResult(null);
                        setGaDisplay('');
                        return;
                    }
                    currentGaWeeks = parseFloat(manualGa);
                    gaString = `${currentGaWeeks} wks`;
                } else {
                    if (!edd || !visitDate) {
                        setCalculationResult(null);
                        setGaDisplay('');
                        return;
                    }
                    
                    const eddDate = new Date(edd);
                    const vDate = new Date(visitDate);
                    const diffTime = eddDate - vDate;
                    const daysRemaining = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    const daysPregnant = 280 - daysRemaining;
                    
                    if (daysPregnant < 0) {
                        setCalculationResult(null);
                        setGaDisplay('');
                        return;
                    }

                    currentGaWeeks = Math.floor(daysPregnant / 7);
                    const currentGaDays = daysPregnant % 7;
                    gaString = `${currentGaWeeks} wks ${currentGaDays} days`;
                }

                setGaDisplay(gaString);

                if (!weight) {
                    setCalculationResult(null);
                    return;
                }

                const w = parseFloat(weight);
                if (isNaN(w) || isNaN(currentGaWeeks)) return;

                let currentFactor = 0.7;
                let trimester = '1st Trimester';

                if (currentGaWeeks < 14) {
                    currentFactor = 0.7;
                    trimester = '1st Trimester (Week 0-13)';
                } else if (currentGaWeeks >= 14 && currentGaWeeks <= 27) {
                    currentFactor = 0.8;
                    trimester = '2nd Trimester (Week 14-27)';
                } else {
                    currentFactor = 0.9;
                    trimester = '3rd Trimester (Week 28+)';
                }

                setFactor(currentFactor);

                const calculatedTdd = Math.round(w * currentFactor);
                setTdd(calculatedTdd);

                let distribution = {};

                if (regimen === REGIMEN_BASAL_BOLUS) {
                    const totalBasal = Math.round(calculatedTdd * 0.5);
                    const totalBolus = calculatedTdd - totalBasal;
                    const bolusPerMeal = Math.round(totalBolus / 3);
                    const breakfast = bolusPerMeal;
                    const lunch = bolusPerMeal;
                    const dinner = totalBolus - (breakfast + lunch);

                    distribution = {
                        type: 'Basal-Bolus (MDI)',
                        details: [
                            { time: '‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏ä‡πâ‡∏≤', drug: 'Rapid/Regular', dose: breakfast },
                            { time: '‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á', drug: 'Rapid/Regular', dose: lunch },
                            { time: '‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏¢‡πá‡∏ô', drug: 'Rapid/Regular', dose: dinner },
                            { time: '‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô (Bedtime)', drug: 'NPH/Detemir', dose: totalBasal },
                        ]
                    };
                } else {
                    const morningTotal = Math.round(calculatedTdd * (2/3));
                    const eveningTotal = calculatedTdd - morningTotal;
                    const morningNPH = Math.round(morningTotal * (2/3));
                    const morningReg = morningTotal - morningNPH;
                    const eveningNPH = Math.round(eveningTotal * 0.5);
                    const eveningReg = eveningTotal - eveningNPH;

                    distribution = {
                        type: 'Split-Mixed (Twice Daily)',
                        details: [
                            { time: '‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏ä‡πâ‡∏≤', drug: 'NPH', dose: morningNPH, secondaryDrug: 'Regular', secondaryDose: morningReg },
                            { time: '‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏¢‡πá‡∏ô', drug: 'NPH', dose: eveningNPH, secondaryDrug: 'Regular', secondaryDose: eveningReg },
                        ]
                    };
                }

                setCalculationResult({
                    trimester,
                    distribution
                });

            }, [weight, manualGa, edd, visitDate, calcMode, regimen]);

            const copyToClipboard = () => {
                if (!calculationResult) return;
                let text = `Insulin Calculation for GDM\nGA: ${gaDisplay} | Wt: ${weight} kg | TDD: ${tdd} units\n`;
                calculationResult.distribution.details.forEach(item => {
                    text += `- ${item.time}: ${item.drug} ${item.dose} units\n`;
                });
                copyTextToClipboard(text, setShowCopyFeedback);
            };

            const copySmbgToClipboard = () => {
                let text = `SMBG Log Targets\nFasting < 95\nPost-Meal 2hr < 120`;
                copyTextToClipboard(text, setShowSmbgCopyFeedback);
            };

            const copyTextToClipboard = (text, setFeedback) => {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    setFeedback(true);
                    setTimeout(() => setFeedback(false), 2000);
                } catch (err) { console.error(err); }
                document.body.removeChild(textArea);
            }

            // --- View Rendering ---
            if (view === 'logbook') {
                return <LogbookView onBack={() => setView('calculator')} />;
            }
            if (view === 'education') {
                return <EducationView onBack={() => setView('calculator')} />;
            }
            if (view === 'diet') {
                return <DietView onBack={() => setView('calculator')} />;
            }

            return (
                <div className="max-w-md mx-auto my-8 bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-100 min-h-[600px] print:hidden">
                    {/* Header */}
                    <div className="bg-blue-600 p-6 text-white flex justify-between items-start sticky top-0 z-10">
                        <div>
                            <div className="flex items-center gap-3 mb-2">
                                <div className="w-8 h-8"><IconCalculator /></div>
                                <h1 className="text-2xl font-bold">GDM Insulin Calc</h1>
                            </div>
                            <p className="text-blue-100 text-sm">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡∏≠‡∏¥‡∏ô‡∏ã‡∏π‡∏•‡∏¥‡∏ô‡πÉ‡∏ô‡∏´‡∏ç‡∏¥‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏£‡∏†‡πå</p>
                        </div>
                        <div className="flex gap-2">
                            <button 
                                onClick={() => setView('diet')}
                                className="text-white/80 hover:text-white hover:bg-white/10 p-2 rounded-lg transition-all flex flex-col items-center gap-1 text-[10px]"
                            >
                                <div className="w-6 h-6"><IconFood /></div>
                                <span>‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span>
                            </button>
                            <button 
                                onClick={() => setView('education')}
                                className="text-white/80 hover:text-white hover:bg-white/10 p-2 rounded-lg transition-all flex flex-col items-center gap-1 text-[10px]"
                            >
                                <div className="w-6 h-6"><IconBookOpen /></div>
                                <span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ</span>
                            </button>
                        </div>
                    </div>

                    {/* Content Switcher */}
                    <div className="p-6 space-y-6 animate-fade-in">
                        {/* Input Form Section */}
                        <div className="space-y-4">
                            {/* GA Mode */}
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-2">‡∏ß‡∏¥‡∏ò‡∏µ‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏£‡∏£‡∏†‡πå</label>
                                <div className="flex bg-slate-100 p-1 rounded-xl mb-4">
                                    <button onClick={() => setCalcMode('edd')} className={`flex-1 py-2 text-sm font-medium rounded-lg transition-all ${calcMode === 'edd' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å EDD</button>
                                    <button onClick={() => setCalcMode('manual')} className={`flex-1 py-2 text-sm font-medium rounded-lg transition-all ${calcMode === 'manual' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏á (Manual)</button>
                                </div>
                                {calcMode === 'manual' ? (
                                    <div className="relative"><input type="number" value={manualGa} onChange={(e) => setManualGa(e.target.value)} placeholder="‡πÄ‡∏ä‡πà‡∏ô 28" className="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none" /><div className="absolute left-3 top-3.5 text-slate-400 w-5 h-5"><IconClock /></div></div>
                                ) : (
                                    <div className="space-y-3">
                                        <div className="relative"><input type="date" value={edd} onChange={(e) => setEdd(e.target.value)} className="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none" /><div className="absolute left-3 top-3 text-slate-400 w-5 h-5"><IconCalendar /></div></div>
                                        <div className="relative"><input type="date" value={visitDate} onChange={(e) => setVisitDate(e.target.value)} className="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none" /><div className="absolute left-3 top-3 text-slate-400 w-5 h-5"><IconCalendar /></div></div>
                                        {gaDisplay && !calculationResult && <p className="text-sm text-green-600 font-medium bg-green-50 p-2 rounded-lg border border-green-100 text-center">‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏£‡∏£‡∏†‡πå: {gaDisplay}</p>}
                                    </div>
                                )}
                            </div>
                            <div className="relative"><input type="number" value={weight} onChange={(e) => setWeight(e.target.value)} placeholder="‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)" className="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none" /><div className="absolute left-3 top-3.5 font-bold text-xs text-slate-400">kg</div></div>
                            <div className="grid grid-cols-2 gap-2 p-1 bg-slate-100 rounded-xl">
                                <button onClick={() => setRegimen(REGIMEN_BASAL_BOLUS)} className={`py-2 text-sm font-medium rounded-lg ${regimen === REGIMEN_BASAL_BOLUS ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>Basal-Bolus</button>
                                <button onClick={() => setRegimen(REGIMEN_SPLIT_MIXED)} className={`py-2 text-sm font-medium rounded-lg ${regimen === REGIMEN_SPLIT_MIXED ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>Split-Mixed</button>
                            </div>
                        </div>

                        {/* Results & Buttons */}
                        {calculationResult && (
                            <div className="space-y-4">
                                <div className="bg-blue-50 border border-blue-100 rounded-xl p-4">
                                    <div className="flex justify-between items-start mb-2">
                                        <div>
                                            <h3 className="text-sm text-blue-800 font-semibold">Total Daily Dose (TDD)</h3>
                                            <p className="text-xs text-blue-600 mt-1">GA: {gaDisplay} | Factor: {factor}</p>
                                        </div>
                                        <div className="text-3xl font-bold text-blue-700">{tdd} <span className="text-base font-normal">units</span></div>
                                    </div>
                                </div>

                                {/* Regimen Details */}
                                <div className="bg-white border border-slate-200 rounded-xl divide-y divide-slate-100 shadow-sm">
                                    {calculationResult.distribution.details.map((item, index) => (
                                        <div key={index} className="p-3 flex justify-between items-center">
                                            <span className="text-sm font-medium text-slate-600">{item.time}</span>
                                            <div className="text-right font-bold text-slate-800">
                                                {item.drug} <span className="text-blue-600 text-lg">{item.dose}</span> u
                                                {item.secondaryDrug && <div className="mt-1">+ {item.secondaryDrug} <span className="text-blue-600 text-lg">{item.secondaryDose}</span> u</div>}
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                <button onClick={copyToClipboard} className="w-full py-3 px-4 bg-slate-800 hover:bg-slate-900 text-white rounded-xl font-medium flex items-center justify-center gap-2">
                                    {showCopyFeedback ? <><IconCheck /><span className="text-green-400">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß</span></> : <><IconCopy /><span>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</span></>}
                                </button>

                                {/* SMBG Buttons */}
                                <div className="flex gap-2">
                                    <button onClick={() => setShowSmbg(!showSmbg)} className="flex-1 py-2 px-4 bg-white border border-slate-200 hover:bg-slate-50 text-slate-600 rounded-xl text-xs flex items-center justify-center gap-2">
                                        <div className="w-4 h-4"><IconTable /></div>
                                        {showSmbg ? '‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á' : '‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 1 ‡∏ß‡∏±‡∏ô'}
                                    </button>
                                    <button onClick={() => setView('logbook')} className="flex-1 py-2 px-4 bg-green-50 border border-green-200 hover:bg-green-100 text-green-700 rounded-xl text-xs font-bold flex items-center justify-center gap-2">
                                        <div className="w-4 h-4"><IconPrinter /></div>
                                        ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° 30 ‡∏ß‡∏±‡∏ô
                                    </button>
                                </div>
                                
                                {showSmbg && (
                                    <div className="bg-white rounded-xl border border-slate-200 p-4 space-y-3 shadow-sm text-xs">
                                        <h4 className="font-bold text-slate-800">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á SMBG (1 ‡∏ß‡∏±‡∏ô)</h4>
                                        <div className="overflow-hidden rounded-lg border border-slate-200">
                                            <table className="w-full text-left">
                                                <thead className="bg-slate-50 text-slate-500 font-semibold uppercase"><tr><th className="px-3 py-2">‡∏°‡∏∑‡πâ‡∏≠</th><th className="px-3 py-2 text-right">Target</th></tr></thead>
                                                <tbody className="divide-y divide-slate-100">
                                                    <tr><td className="px-3 py-2">Fasting</td><td className="px-3 py-2 text-right text-green-700 font-bold">&lt; 95</td></tr>
                                                    <tr><td className="px-3 py-2">Post-Meal 2hr</td><td className="px-3 py-2 text-right text-green-700 font-bold">&lt; 120</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                        
                        {!calculationResult && <div className="text-center py-8 text-slate-400"><p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</p></div>}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<InsulinCalculator />);
    </script>
</body>
</html>
